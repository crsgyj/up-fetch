"use strict";var R=Object.defineProperty;var A=Object.getOwnPropertyDescriptor;var V=Object.getOwnPropertyNames;var j=Object.prototype.hasOwnProperty;var B=(e,t)=>{for(var r in t)R(e,r,{get:t[r],enumerable:!0})},J=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of V(t))!j.call(e,s)&&s!==r&&R(e,s,{get:()=>t[s],enumerable:!(n=A(t,s))||n.enumerable});return e};var U=e=>J(R({},"__esModule",{value:!0}),e);var q={};B(q,{ResponseError:()=>p,isJsonifiable:()=>u,isResponseError:()=>T,isValidationError:()=>D,up:()=>k});module.exports=U(q);var p=class extends Error{constructor(t,r,n){super(`[${t.status}] ${t.statusText}`),this.data=r,this.name="ResponseError",this.response=t,this.status=t.status,this.request=n}},T=e=>e instanceof p;var f=class extends Error{constructor(t,r){super(JSON.stringify(t.issues)),this.name="ValidationError",this.issues=t.issues,this.data=r}},D=e=>e instanceof f;var E=e=>{let t={};return e.forEach(r=>{new Headers(r).forEach((n,s)=>{n==="null"||n==="undefined"?delete t[s]:t[s]=n})}),t},F=(e,t)=>"any"in AbortSignal?AbortSignal.any([e,t&&AbortSignal.timeout(t)].filter(Boolean)):e,S=(e,t=[])=>{let r={...e};for(let n in r)t.includes(n)&&delete r[n];return r},u=e=>L(e)||Array.isArray(e)||typeof e?.toJSON=="function",L=e=>e&&typeof e=="object"&&e.constructor?.name==="Object",P=(e="",t,r,n,s)=>{t=t.href??t;let o=s({...S(r,[...new URL(t,"http://a").searchParams.keys()]),...n}),a=/^https?:\/\//.test(t)?t:!e||!t?e+t:e.replace(/\/$/,"")+"/"+t.replace(/^\//,"");return o&&(a+=(a.includes("?")?"&":"?")+o.replace(/^\?/,"")),a},v=(e,t)=>new Promise((r,n)=>{t?.addEventListener("abort",o,{once:!0});let s=setTimeout(()=>{t?.removeEventListener("abort",o),r()},e);function o(){clearTimeout(s),n(t.reason)}});async function O(e,t){let r=await e["~standard"].validate(t);if(r.issues)throw new f(r,t);return r.value}var h={parseResponse:e=>e.clone().json().catch(()=>e.text()).then(t=>t||null),parseRejected:async(e,t)=>new p(e,await h.parseResponse(e,t),t),serializeParams:e=>new URLSearchParams(JSON.parse(JSON.stringify(e))).toString(),serializeBody:e=>u(e)?JSON.stringify(e):e,reject:e=>!e.ok,retry:{when:e=>e.response?.ok===!1,attempts:0,delay:0}};async function x(e,t){let r="ok"in e,n=e.body||e._bodyInit;if(!t||!n)return e;let s=e.headers.get("content-length"),o=+(s||0);if(!r&&!s)for await(let i of e.clone().body)o+=i.byteLength;let a=0;t({totalBytes:o,transferredBytes:a,chunk:new Uint8Array},e);let m=new ReadableStream({async start(i){for await(let d of e.body)a+=d.byteLength,o=Math.max(o,a),t({totalBytes:o,transferredBytes:a,chunk:d},e),i.enqueue(d);i.close()}});return r?new Response(m,e):new Request(e,{body:m,duplex:"half"})}var g={},k=(e,t=()=>g)=>async(r,n=g,s)=>{let o=await t(r,n,s),a={...h,...o,...n,...g,retry:{...h.retry,...o.retry,...n.retry}};Object.keys(o).forEach(c=>{/^on[A-Z]/.test(c)&&(a[c]=(...y)=>{o[c]?.(...y),n[c]?.(...y)})}),a.body=n.body===null||n.body===void 0?n.body:a.serializeBody(n.body),a.headers=E([u(n.body)&&typeof a.body=="string"?{"content-type":"application/json"}:{},o.headers,n.headers]);let m=0,i,d={};try{do{a.signal=F(n.signal,a.timeout),i=await x(new Request(r.url?r:P(a.baseUrl,r,o.params,n.params,a.serializeParams),a),a.onRequestStreaming),a.onRequest?.(i);try{d.response=await x(await e(i,{...S(a,["body"]),headers:i.headers},s),a.onResponseStreaming)}catch(l){d.error=l}if(!await a.retry.when({request:i,...d})||++m>(typeof a.retry.attempts=="function"?await a.retry.attempts({request:i}):a.retry.attempts))break;await v(typeof a.retry.delay=="function"?await a.retry.delay({attempt:m,request:i,...d}):a.retry.delay,a.signal),a.onRetry?.({attempt:m,request:i,...d})}while(!0);if(d.error)throw d.error;let c=d.response;if(!await a.reject(c)){let l;try{l=await a.parseResponse(c,i)}catch(w){throw w}let b;try{b=a.schema?await O(a.schema,l):l}catch(w){throw w}return a.onSuccess?.(b,i),b}let y;try{y=await a.parseRejected(c,i)}catch(l){throw l}throw y}catch(c){let y=a.parseError?.(c,i);throw a.onError?.(y??c,i),y??c}};0&&(module.exports={ResponseError,isJsonifiable,isResponseError,isValidationError,up});
//# sourceMappingURL=index.cjs.map