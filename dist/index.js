var m=class extends Error{constructor(t,n,r){super(`[${t.status}] ${t.statusText}`),this.data=n,this.name="ResponseError",this.response=t,this.status=t.status,this.request=r}},P=e=>e instanceof m;var u=class extends Error{constructor(t,n){super(JSON.stringify(t.issues)),this.name="ValidationError",this.issues=t.issues,this.data=n}},v=e=>e instanceof u;var g=e=>{let t={};return e.forEach(n=>{new Headers(n).forEach((r,i)=>{r==="null"||r==="undefined"?delete t[i]:t[i]=r})}),t},T=(e,t)=>"any"in AbortSignal?AbortSignal.any([e,t&&AbortSignal.timeout(t)].filter(Boolean)):e,R=(e,t=[])=>{let n={...e};for(let r in n)t.includes(r)&&delete n[r];return n},f=e=>O(e)||Array.isArray(e)||typeof e?.toJSON=="function",O=e=>e&&typeof e=="object"&&e.constructor?.name==="Object",D=(e="",t,n,r,i)=>{t=t.href??t;let s=i({...R(n,[...new URL(t,"http://a").searchParams.keys()]),...r}),a=/^https?:\/\//.test(t)?t:!e||!t?e+t:e.replace(/\/$/,"")+"/"+t.replace(/^\//,"");return s&&(a+=(a.includes("?")?"&":"?")+s.replace(/^\?/,"")),a},E=(e,t)=>new Promise((n,r)=>{t?.addEventListener("abort",s,{once:!0});let i=setTimeout(()=>{t?.removeEventListener("abort",s),n()},e);function s(){clearTimeout(i),r(t.reason)}});async function F(e,t){let n=await e["~standard"].validate(t);if(n.issues)throw new u(n,t);return n.value}var h={parseResponse:e=>e.clone().json().catch(()=>e.text()).then(t=>t||null),parseRejected:async(e,t)=>new m(e,await h.parseResponse(e,t),t),serializeParams:e=>new URLSearchParams(JSON.parse(JSON.stringify(e))).toString(),serializeBody:e=>f(e)?JSON.stringify(e):e,reject:e=>!e.ok,retry:{when:e=>e.response?.ok===!1,attempts:0,delay:0}};async function S(e,t){let n="ok"in e,r=e.body||e._bodyInit;if(!t||!r)return e;let i=e.headers.get("content-length"),s=+(i||0);if(!n&&!i)for await(let o of e.clone().body)s+=o.byteLength;let a=0;t({totalBytes:s,transferredBytes:a,chunk:new Uint8Array},e);let p=new ReadableStream({async start(o){for await(let d of e.body)a+=d.byteLength,s=Math.max(s,a),t({totalBytes:s,transferredBytes:a,chunk:d},e),o.enqueue(d);o.close()}});return n?new Response(p,e):new Request(e,{body:p,duplex:"half"})}var x={},k=(e,t=()=>x)=>async(n,r=x,i)=>{let s=await t(n,r,i),a={...h,...s,...r,...x,retry:{...h.retry,...s.retry,...r.retry}};Object.keys(s).forEach(c=>{/^on[A-Z]/.test(c)&&(a[c]=(...y)=>{s[c]?.(...y),r[c]?.(...y)})}),a.body=r.body===null||r.body===void 0?r.body:a.serializeBody(r.body),a.headers=g([f(r.body)&&typeof a.body=="string"?{"content-type":"application/json"}:{},s.headers,r.headers]);let p=0,o,d={};try{do{a.signal=T(r.signal,a.timeout),o=await S(new Request(n.url?n:D(a.baseUrl,n,s.params,r.params,a.serializeParams),a),a.onRequestStreaming),a.onRequest?.(o);try{d.response=await S(await e(o,{...R(a,["body"]),headers:o.headers},i),a.onResponseStreaming)}catch(l){d.error=l}if(!await a.retry.when({request:o,...d})||++p>(typeof a.retry.attempts=="function"?await a.retry.attempts({request:o}):a.retry.attempts))break;await E(typeof a.retry.delay=="function"?await a.retry.delay({attempt:p,request:o,...d}):a.retry.delay,a.signal),a.onRetry?.({attempt:p,request:o,...d})}while(!0);if(d.error)throw d.error;let c=d.response;if(!await a.reject(c)){let l;try{l=await a.parseResponse(c,o)}catch(w){throw w}let b;try{b=a.schema?await F(a.schema,l):l}catch(w){throw w}return a.onSuccess?.(b,o),b}let y;try{y=await a.parseRejected(c,o)}catch(l){throw l}throw y}catch(c){let y=a.parseError?.(c,o);throw a.onError?.(y??c,o),y??c}};export{m as ResponseError,f as isJsonifiable,P as isResponseError,v as isValidationError,k as up};
//# sourceMappingURL=index.js.map